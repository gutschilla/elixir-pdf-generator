# Elixir CircleCI 2.0 configuration file
#
# Check https://circleci.com/docs/2.0/language-elixir/ for more details
version: 2.1
executors:
  elixir:
    docker:
      - image: elixir:<< parameters.version >>-alpine
    parameters:
      version:
        default: ""
        type: string
    working_directory: ~/repo
jobs:
  build:
    executor:
      name: elixir
      version: << parameters.version >>
    parameters:
      version:
        default: ""
        type: string
    steps:
      - checkout
      - run: apk add make nodejs nodejs-npm wkhtmltopdf xvfb-run chromium-chromedriver chromium
      - run: mix local.hex --force
      - run: mix local.rebar --force
      - run: mix deps.get
      - run:
          command: npm install
          working_directory: priv
      - run:
          command: npm -g install chrome-headless-render-pdf puppeteer
          environment:
            DEBIAN_FRONTEND: "noninteractive"
            PUPPETEER_SKIP_CHROMIUM_DOWNLOAD: "TRUE"
      - run: mix test
workflows:
  ci:
    jobs:
      - build:
          name: elixir-1-9
          version: "1.9.4"
      - build:
          name: elixir-1-10
          version: "1.10.4"
